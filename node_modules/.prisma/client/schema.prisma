// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ShopToken {
  id           String   @id @default(uuid())
  shopId       BigInt   @unique
  accessToken  String
  refreshToken String
  expireIn     Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Product {
  id          String   @id @default(uuid())
  itemId      BigInt   @unique
  shopId      BigInt
  name        String
  description String?
  price       Float
  stock       Int
  ratingStar  Float?
  sales       Int?
  views       Int?
  images      String[] @default([]) // URLs das imagens
  attributes  Json? // Ficha técnica como JSON
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Order {
  id               String   @id @default(uuid())
  orderSn          String   @unique
  shopId           BigInt
  orderStatus      String
  shippingCarrier  String?
  totalAmount      Float
  currency         String
  recipientAddress Json? // Endereço completo como JSON
  items            Json[] // Itens do pedido como JSON
  createTime       DateTime
  updateTime       DateTime
  trackingNumber   String?
  // Campos para alertas
  addressChanged   Boolean  @default(false)
  delayRisk        Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
}

model Alert {
  id         String   @id @default(uuid())
  shopId     BigInt
  orderSn    String?
  productId  BigInt?
  type       String // "ADDRESS_CHANGE", "SHIPPING_DELAY", "DELIVERY_DELAY"
  message    String
  isResolved Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
